# Алокації

## Проблема

Уявіть, що ви робите пул об'єктів чи будь-яку іншу колекцію даних. Рано чи пізно кількості елементів, які ви створюєте в конструкторі колекції, вам перестане вистачати і у вас виникне потреба зробити так, щоб вона могла змінювати свій розмір - якщо кулі з пулу раптово почнуть перевикористовуватися до того, як вони будуть запушені назад, то ваші кулемети швидко перетворяться на дробовики.

Спочатку все добре, ви додаєте один елемент щоразу, коли вам не вистачає обсягу. Потім ви розумієте, що операція відбувається занадто часто і це викликає стрибки garbage collector'у. Ви вирішуєте не винаходити велосипед, а додавати нових елементів, як це робить List в System.Collections - щоразу збільшуючи об'єм удвічі.

Потім ви розумієте, що ця стратегія починає втрачати ефективність з кожним новим ступенем двійки. Крім того, ви починаєте розуміти, що хочете контролювати процес повністю - мати можливість вказувати, скільки елементів створюється спочатку і додається щоразу, коли колекція виснажується.

## Рішення

* Колекції містять логіку роботи та делегат, виклик якого змінює їх розмір
* Правила зміни та кількість елементів задаються структурою – дескриптором алокацій
* Фабрики для створення колекцій приймають у якості аргументів дескриптори алокацій - один для початкової, другий для додаткової при зміні розміру
* Дескриптори алокацій інкапсулюються разом з делегатами алокацій, відповідальними за створення нових екземплярів, у патерн Command
* Фабрики використовують команди алокацій для створення колекцій і додають де потрібно команду алокації у створені колекції для досягнення можливості змінювати свій розмір.

### Відповідальності

* За створення екземплярів колекцій та елементів відповідає фабрика
* За визначення правил алокації та кількості відповідає дескриптор
* За алгоритм алокації відповідає делегат у команді алокації, за вибір методу для делегата відповідає фабрика
* За виклик на модифікацію колекції відповідає сама колекція

### Класи

* `EAllocationAmountRule`

Enum. Вказує правило, яким прораховується кількість елементів у колекції під час ініціалізації чи доповнення. ZERO - алокується 0 елементів, ADD_ONE - додається 1 новий, DOUBLE_AMOUNT - кількість збільшується вдвічі, ADD_PREDEFINED_AMOUNT - додається задана кількість елементів

* `AllocationCommandDescriptor`

Серіалізуєма структура. Інкапсулює правило алокації і кількість елементів, що алокуються.

* `AllocationCommandDescriptor`

Паттерн Command. Інкапсулює дескриптор та делегат, який виробляє новий екземпляр потрібного типу